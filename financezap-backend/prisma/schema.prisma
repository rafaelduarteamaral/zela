generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:../database.sqlite"
}

model Transacao {
  id               Int      @id @default(autoincrement())
  telefone         String
  descricao        String
  valor            Float
  categoria        String   @default("outros")
  tipo             String   @default("saida") // "entrada" ou "saida"
  metodo           String   @default("debito") // "credito" ou "debito"
  dataHora         String
  data             String
  mensagemOriginal String?
  carteiraId       Int?     // ID da carteira (opcional para compatibilidade)
  criadoEm         DateTime @default(now())

  // Relação com carteira
  carteira         Carteira? @relation(fields: [carteiraId], references: [id], onDelete: SetNull)

  @@index([telefone])
  @@index([data])
  @@index([categoria])
  @@index([tipo])
  @@index([metodo])
  @@index([carteiraId])
  @@map("transacoes")
}

model NumeroRegistrado {
  id                      Int       @id @default(autoincrement())
  telefone                String    @unique
  primeiraMensagemEnviada DateTime  @default(now())
  ultimaMensagemEnviada   DateTime?
  totalMensagensEnviadas  Int       @default(1)

  @@index([telefone])
  @@map("numeros_registrados")
}

model Usuario {
  id              Int       @id @default(autoincrement())
  telefone        String    @unique
  nome            String
  email           String?
  dataCadastro    DateTime  @default(now())
  trialExpiraEm   DateTime  // Data de expiração do trial (7 dias após cadastro)
  status          String    @default("trial") // "trial", "ativo", "expirado"
  plano           String?   // "mensal", "trimestral", "anual" - null se ainda em trial
  assinaturaEm    DateTime? // Data da assinatura (quando assinar)
  templateAtivoId Int?      // ID do template ativo
  carteiraPadraoId Int?     // ID da carteira padrão
  criadoEm        DateTime  @default(now())
  atualizadoEm    DateTime  @updatedAt

  @@index([telefone])
  @@index([status])
  @@map("usuarios")
}

model Agendamento {
  id              Int       @id @default(autoincrement())
  telefone        String
  descricao       String
  valor           Float
  dataAgendamento String    // Data no formato YYYY-MM-DD
  tipo            String    @default("pagamento") // "pagamento" ou "recebimento"
  status          String    @default("pendente") // "pendente", "pago", "cancelado"
  categoria       String?   // Categoria do agendamento
  notificado      Boolean   @default(false) // Se já foi enviada notificação
  // Campos para agendamentos recorrentes
  recorrente      Boolean   @default(false) // Se é um agendamento recorrente
  totalParcelas   Int?      // Total de parcelas (ex: 36, 10)
  parcelaAtual    Int?      // Parcela atual (1, 2, 3...)
  agendamentoPaiId Int?     // ID do agendamento original (para rastrear a série)
  criadoEm        DateTime  @default(now())
  atualizadoEm    DateTime  @updatedAt

  @@index([telefone])
  @@index([dataAgendamento])
  @@index([status])
  @@index([agendamentoPaiId])
  @@index([recorrente])
  @@map("agendamentos")
}

model Categoria {
  id          Int       @id @default(autoincrement())
  telefone    String?   // Telefone do usuário (null para categorias padrão globais)
  nome        String
  descricao   String?   // Descrição opcional da categoria
  cor         String?   // Cor em hex para identificação visual (opcional)
  padrao      Int       @default(0) // 0 = false, 1 = true (SQLite não tem boolean)
  tipo        String    @default("saida") // "entrada", "saida" ou "ambos"
  criadoEm    DateTime  @default(now())
  atualizadoEm DateTime @updatedAt

  @@index([telefone])
  @@index([padrao])
  @@map("categorias")
}

model Template {
  id              Int       @id @default(autoincrement())
  telefone        String    // Telefone do usuário
  nome            String    // Nome do template (ex: "Dark", "Light", "Personalizado")
  tipo            String    @default("custom") // "dark", "light", "custom"
  corPrimaria     String    // Cor primária em hex
  corSecundaria   String    // Cor secundária em hex
  corDestaque     String    // Cor de destaque em hex
  corFundo        String    // Cor de fundo em hex
  corTexto        String    // Cor de texto em hex
  ativo           Int       @default(0) // 0 = false, 1 = true (template ativo)
  criadoEm        DateTime  @default(now())
  atualizadoEm    DateTime  @updatedAt

  @@index([telefone])
  @@index([ativo])
  @@map("templates")
}

model Carteira {
  id              Int       @id @default(autoincrement())
  telefone        String    // Telefone do usuário
  nome            String    // Nome da carteira (ex: "Carteira Principal", "Poupança")
  descricao       String?   // Descrição opcional
  tipo            String    @default("debito") // "debito" ou "credito"
  limiteCredito   Float?    // Limite da conta de crédito (apenas para tipo "credito")
  diaPagamento    Int?      // Dia do mês para pagamento da fatura (apenas para tipo "credito", 1-31)
  padrao          Int       @default(0) // 0 = false, 1 = true (carteira padrão)
  ativo           Int       @default(1) // 0 = false, 1 = true (carteira ativa)
  criadoEm        DateTime  @default(now())
  atualizadoEm    DateTime  @updatedAt

  // Relação com transações
  transacoes      Transacao[]

  @@index([telefone])
  @@index([padrao])
  @@index([ativo])
  @@index([tipo])
  @@map("carteiras")
}
